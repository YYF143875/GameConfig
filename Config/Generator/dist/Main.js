"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const t=require("./DataModel"),l=require("./genModules/GenOriginModule"),i=e(require("cli-color")),o=e(require("uglify-js")),r=require("./genModules/GenTSModule"),n=require("./genModules/GenCSModule"),u=require("./utils/IOUtils"),a=e(require("fs")),d=e(require("path")),s=require("./CodeLanguageEnum");t.DataModel.Instance.reset();let c=l.GenOriginModule.Instance.gen();if(c){let l=t.DataModel.Instance.config.exports;for(let e=0;e<l.length;e++){const g=l[e];if(g.enabled){let e=d.default.dirname(g.export_url);if(!u.IOUtils.fileOrFolderIsExsit(g.export_script_url)){if(!g.force_make_dir){console.log(i.default.yellow(g.id+" 发布失败，路径不存在："+g.export_script_url));continue}u.IOUtils.makeDir(g.export_script_url)}if(!u.IOUtils.fileOrFolderIsExsit(e)){if(!g.force_make_dir){console.log(i.default.yellow(g.id+" 发布失败，路径不存在："+e));continue}u.IOUtils.makeDir(e)}switch(t.DataModel.Instance.reset(),g.code_language){case s.CodeLanguageEnum.CS:c=n.GenCSModule.Instance.gen(g.id);break;case s.CodeLanguageEnum.TS:c=r.GenTSModule.Instance.gen(g.id);break;default:console.log(i.default.red(g.id+" 发布失败，路径不存在："+e))}if(!c)break}}}let f=[];u.IOUtils.findFile("dist",[".js",".JS"],f);for(let r=f.length-1;0<=r;r--){let e=f[r],l=a.default.readFileSync(e,{encoding:"utf-8"}),t={mangle:{toplevel:!0}},i=o.default.minify(l,t);if(l==i.code)break;u.IOUtils.writeTextFile(e,i.code)}c?console.log(i.default.green("\n<<< 所有配置发布完成！>>>")):console.log(i.default.yellow("发布配置失败，发布配置过程中出现错误！请向上翻看是否有报错信息。"));